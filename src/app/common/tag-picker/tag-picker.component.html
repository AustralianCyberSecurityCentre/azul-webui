<div class="relative z-10 w-full break-words text-ellipsis">
  Tags are limited to 25 lowercase alphanumeric and '-' only.
  <flow-input
    #tagInput
    [id]="'tagInput'"
    placeholder="my-tag-45"
    [formControl]="tagName"
    pattern="[a-z0-9\-]*$"
    maxlength="25"
    (inputFocus)="showExistingTagsSignal.set(true)"
    (inputFocusOut)="handleFocusOut($event)"
    (keydown)="closeOnEnter($event)"
  />
  @if (isEntityTag) {
    @if (allEntityTagsFiltered$ | async; as allEntityTagsFilteredList) {
      <ng-container
        *ngTemplateOutlet="
          tplPaginate;
          context: { allTagsFilteredList: allEntityTagsFilteredList }
        "
      />
    }
  } @else {
    <!-- Must be a feature tag if not an entity tag.-->
    @if (allFeatureTagsFiltered$ | async; as allFeatureTagsFilteredList) {
      <ng-container
        *ngTemplateOutlet="
          tplPaginate;
          context: { allTagsFilteredList: allFeatureTagsFilteredList }
        "
      />
    }
  }
</div>

<ng-template #tplPaginate let-allTagsFilteredList="allTagsFilteredList">
  @if (showExistingTagsSignal()) {
    <div
      class="border-azul-500 bg-azul-50 dark:border-azul-600 dark:bg-azul-700 absolute top-[calc(100%-1rem)] -z-10 w-full rounded-lg border p-2 shadow-xl overflow-y-scroll"
    >
      <hr class="mx-8 my-1 h-px border-0 bg-gray-200 dark:bg-gray-700" />
      <div class="max-h-80 [@media(max-height:600px)]:max-h-40">
      <table class="w-full">
        <tbody class="overflow-y-scroll">
          @for (existingTag of allTagsFilteredList; track existingTag) {
            <tr
              class="cursor-pointer break-all text-ellipsis focus-within:bg-gray-700 focus-within:text-white hover:bg-gray-700 hover:text-white"
            >
              <td
                id="tag-suggestion-{{ existingTag }}"
                (focusout)="handleFocusOut($event)"
                [title]="existingTag"
                (click)="setTagValue(existingTag)"
                (keydown)="keyDownActionOnTagValue($event, existingTag)"
              >
                {{ existingTag }}
              </td>
            </tr>
          }
        </tbody>
      </table>
      </div>
    </div>
  }
</ng-template>
